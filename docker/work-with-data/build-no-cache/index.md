---
metaTitle: Сборка образа без кеширования в Docker
metaDescription: Узнайте, как в Docker собирать образ без кеширования, чтобы гарантировать обновление зависимостей и устранение проблем, связанных с устаревшими данными
author: Иван Петров
title: Сборка образа без кеширования в Docker
preview: Откройте для себя сборку Docker-образа без кеширования, узнайте, почему это важно для обновления зависимостей, и как это реализовать в ваших проектах
---

## Введение

В мире контейнеризации Docker стал неотъемлемым инструментом для разработки и развёртывания приложений. Он позволяет создавать образы, которые содержат всё необходимое для запуска ваших приложений. Однако в процессе разработки часто возникает необходимость в сборке образа без использования кэша. Это может быть необходимо, если вы хотите удостовериться, что все зависимости и компоненты вашего приложения загружаются заново и работают с самыми актуальными версиями. Ниже мы рассмотрим, как собирать Docker-образы без кэширования и в каких случаях это может потребоваться.

### Как работает кеширование в Docker?

Docker использует механизм кеширования для ускорения процесса сборки образов. Когда вы создаёте образ, Docker запоминает промежуточные слои, что позволяет использовать их повторно при следующей итерации сборки. Это значительно экономит время и ресурсы, особенно если у изображений много общих слоев. Однако кеширование может привести к тому, что не будут учтены изменения в исходных файлах или пакетах.

Сборка без кеширования может быть полезна, но для эффективной работы необходимо понимать, как правильно выстраивать слои в Dockerfile и оптимизировать процесс сборки. Если вы хотите детальнее погрузиться в мир Docker — приходите на наш большой курс [Docker + Ansible - с нуля](https://purpleschool.ru/course/docker). На курсе 159 уроков и 7 упражнений, AI-тренажеры для безлимитной практики с кодом и задачами 24/7, решение задач с живым ревью наставника, еженедельные встречи с менторами. Вы научитесь создавать эффективные Dockerfile, управлять кэшем и оптимизировать процесс сборки.

Обратите внимание на базовый сценарий: у вас есть Dockerfile и вы запускаете команду:

```bash
docker build -t myimage .
```

Если в процессе предыдущей сборки не произошло изменений в инструкциях Dockerfile или исходных данных, Docker использует закешированные слои, что может привести к тому, что обновления зависимостей будут проигнорированы.

## Основная часть

### Зачем отключать кеширование?

Хотя кэширование и ускоряет сборку образов, оно имеет недостатки. Например, если изменились важные зависимости или базовый образ, на который вы ссылаетесь в Dockerfile, старые данные могут оставаться неизменными, что может приводить к неожиданным ошибкам. В таких случаях необходимо отключение кэша сборки, чтобы гарантировать, что ваше приложение использует актуальные версии всех компонентов.

### Реализация сборки образа без кеширования

Сборка Docker-образа без кеширования достигается использованием флага `--no-cache`. Теперь я покажу, как это сделать на практике.

#### Пример Dockerfile

Рассмотрим простой Dockerfile:

```dockerfile
# Указываем базовый образ
FROM node:14

# Устанавливаем рабочую директорию
WORKDIR /app

# Копируем package.json и package-lock.json для установки зависимостей
COPY package*.json ./

# Устанавливаем зависимости
RUN npm install

# Копируем остальные файлы приложения
COPY . .

# Указываем команду, которая будет выполняться при запуске контейнера
CMD [ "node", "app.js" ]
```

#### Сборка без кеширования

Теперь, чтобы собрать образ без использования кэша, используем следующую команду:

```bash
docker build --no-cache -t myimage .
```

Обратите внимание, что эта команда игнорирует все закешированные слои, и все инструкции Dockerfile будут выполнены заново. Это особенно полезно, если недавно обновились пакеты в `package.json`, и вы хотите убедиться, что они будут пересобраны.

### Когда стоит использовать `--no-cache`?

Рассмотрим случаи, когда полезно отключить кеширование:

1. **Обновление зависимостей**: Когда меняются версии библиотек или фреймворков, которые ваше приложение использует.
2. **Изменение базового образа**: Если вышла свежая версия используемого базового образа.
3. **Диагностика и устранение неполадок**: Полезно для проверки, устранения и предотвращения проблем, связанных с устаревшими данными.
4. **Смена окружения**: Если ваш проект переключается между различными окружениями, и вы хотите удостовериться, что всё соответствует текущему окружению.

## Заключение

Сборка Docker-образа без кеширования важна в тех случаях, когда необходимо удостовериться в актуальности всех библиотек и зависимостей вашего приложения. Это может быть критично для обновления безопасности, устранения багов и обеспечения стабильной работы приложения. Использование флага `--no-cache` позволяет запускать все инструкции Dockerfile заново, гарантируя, что всё будет собрано с нуля. Это не только полезно при разработке, но и при диагностике ошибок, связанных с устаревшими кешированными данными. Надеюсь, данное руководство поможет вам лучше понять, как использовать эту возможность в Docker для обеспечения свежести и актуальности ваших контейнеров.

Сборка без кеширования помогает избежать проблем с устаревшими данными, но для развертывания сложных приложений в production требуется автоматизация и оркестрация. На нашем курсе [Docker + Ansible - с нуля](https://purpleschool.ru/course/docker) вы изучите, как создавать Docker Swarm кластеры, использовать Ansible для автоматизации развертывания и строить системы мониторинга. В первых 3 модулях уже доступно бесплатное содержание — начните погружаться в мир Docker и Ansible прямо сегодня.
