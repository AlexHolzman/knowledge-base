---
metaTitle: Перезапуск контейнера при сбоях состояния в Docker
metaDescription: Изучите, как Docker автоматически перезапускает контейнеры при их сбоях. Примеры, пояснения и настройка параметров для надежной работы ваших приложений
author: Олег Марков
title: Перезапуск контейнера при сбоях состояния в Docker
preview: Узнайте, как обеспечить стабильность и надежность ваших контейнеризированных приложений. Перезапуск контейнеров при сбоях – важная функция Docker
---

## Введение

Docker стал неотъемлемой частью разработки и развертывания приложений благодаря возможности контейнеризации. Однако даже самое стабильное приложение может столкнуться со сбоем. В таких случаях вам необходимо, чтобы ваше приложение быстро восстановилось и продолжило свою работу без вашего вмешательства. В этом может помочь функция автоматического перезапуска контейнеров в Docker. В этой статье мы разберем, как настроить Docker для автоматического перезапуска контейнеров, что делать при возникновении сбоев и как это поможет сохранить стабильность вашего приложения.

### Основные параметры перезапуска

Docker предоставляет несколько стратегий перезапуска контейнеров, которые могут быть полезны в различных сценариях. Основными параметрами, которые управляют перезапуском, являются `--restart`, `on-failure`, `always` и `unless-stopped`. Давайте рассмотрим их подробнее.

Автоматический перезапуск контейнеров — важная часть обеспечения надежности приложений. Чтобы детально разобраться в этом механизме, нужно хорошо понимать, как Docker управляет жизненным циклом контейнеров. Если вы хотите детальнее погрузиться в Docker, узнать про настройку VM на Linux, базовые понятия Docker, Docker image, сети Docker — приходите на наш большой курс [Docker + Ansible - с нуля](https://purpleschool.ru/course/docker).

#### Параметр `--restart`

Этот параметр позволяет указать Docker, как действовать в случае завершения работы контейнера. Он задается при запуске контейнера и может иметь несколько значений. 

Пример запуска контейнера с параметром `--restart`:
```bash
docker run --name my_container --restart=always my_image
```
В этом примере Docker будет автоматически перезапускать контейнер при любых его завершениях или сбоях.

#### Опция `on-failure`

Опция `on-failure` полезна, если вы хотите перезапускать контейнер только в случае ненормального завершения. Это может быть полезно для отладки приложения, когда нормальное завершение указывает на успешное выполнение задачи.

```bash
docker run --name my_container --restart=on-failure my_image
```

Вы можете дополнительно ограничить количество попыток перезапуска, указав число после `on-failure`. Например: 
```bash
docker run --name my_container --restart=on-failure:3 my_image
```
Этот код перезапустит контейнер только три раза, если он завершится с ошибкой.

#### Стратегия `always`

Стратегия `always` гарантирует, что ваш контейнер будет перезапущен всегда, независимо от причины его остановки. 

```bash
docker run --name my_container --restart=always my_image
```

Это отличный выбор для критически важных сервисов, так как система будет пытаться поддерживать их в рабочем состоянии постоянно.

#### Использование `unless-stopped`

Эта стратегия похожа на `always`, за исключением того, что контейнер не будет перезапущен, если он был явно остановлен пользователем.

```bash
docker run --name my_container --restart=unless-stopped my_image
```
Выбирая этот вариант, вы получаете безопасный механизм, который оставляет за вами контроль над остановками контейнера.

### Примеры работы Docker с перезапуском

Давайте рассмотрим, как Docker ведет себя в конкретных случаях отказов и перезапуска, используя различные параметры.

#### Пример с `on-failure`
Предположим, у нас есть контейнер, который выполняет критическую задачу, но иногда выходит за пределы времени выполнения из-за нагрузки:

```bash
docker run --name critical_task --restart=on-failure critical_image
```
В этом случае Docker автоматически будет перезапускать задачу, если она завершится с ошибкой выполнения. Это поможет сохранить непрерывность выполнения важной операции.

#### Пример с `always`
Если вы развернули веб-сервер и он является основой для вашего приложения:
```bash
docker run -d --name web_server --restart=always web_image
```
Даже если сервер по какой-то причине упадет, он будет автоматически перезапущен, что обеспечит минимальное время простоя вашего приложения.

### Визуальный контроль состояния контейнеров

Для мониторинга состояния контейнеров и обеспечения их перезапуска, Docker предоставляет полезные команды.

#### Команда `docker ps`
Эта команда показывает все запущенные контейнеры. Вы можете использовать её для проверки состояния ваших контейнеров:
```bash
docker ps
```
Она предоставит информацию о том, какие контейнеры запущены, их идентификаторы, образы и параметры запуска.

#### Команда `docker inspect`
Если вам нужно узнать более подробную информацию о контейнере и его перезапусках, используйте:
```bash
docker inspect my_container
```
Это предоставит полную информацию о контейнере, включая причины перезапусков и их количество.

### Использование в Docker Compose

Docker Compose также поддерживает настройки перезапуска. Вы можете указать параметр `restart` в `docker-compose.yml`.

```yaml
version: '3'
services:
  web:
    image: web_image
    restart: always
```
Этот файл конфигурации определяет сервис, который будет постоянно поддерживаться в рабочем состоянии.

## Заключение

Настройка автоматического перезапуска контейнеров в Docker является мощным инструментом для поддержания бесперебойной работы ваших приложений. Мы рассмотрели основные параметры, такие как `--restart`, `on-failure`, `always` и их применение на практике. Такой функционал позволяет вам обеспечивать стабильность и надежность сервисов, минимизируя вмешательство человека. Надеемся, эта статья расширила ваше понимание управления контейнерами в Docker и вооружила вас инструментами для создания устойчивых приложений.

Для более тонкой настройки перезапуска контейнеров может потребоваться использование инструментов оркестрации. На нашем курсе [Docker + Ansible - с нуля](https://purpleschool.ru/course/docker) вы изучите Docker Swarm, что позволит вам более гибко управлять перезапуском контейнеров. В первых 3 модулях уже доступно бесплатное содержание — начните погружаться в Docker и Ansible прямо сегодня.
