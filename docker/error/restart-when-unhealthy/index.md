---
metaTitle- Перезапуск контейнера при сбоях состояния в Docker
metaDescription- Обнаружьте возможности Docker для автоматического перезапуска контейнеров при сбоях-состояния, узнайте о стратегиях рестарта и их преимуществах
author- Алексей Смирнов
title- Перезапуск контейнера при сбоях состояния в Docker
preview- Узнайте, как Docker помогает автоматически перезапускать контейнеры в случае сбоев-состояния, и какие стратегии рестарта используем для повышения надежности
---

## Введение

В мире контейнеризации Docker стал важнейшим инструментом, позволяющим запускать приложения в изолированных и легковесных средах. Однако, несмотря на все его преимущества, контейнеры иногда могут столкнуться с неожиданными сбоями. Здесь на помощь приходит возможность перезапуска контейнера при сбоях состояния, что позволяет повысить надежность и доступность ваших приложений. В этой статье мы обсудим, как Docker предоставляет функциональность для перезапуска контейнеров, какие стратегии рестарта существуют и как их настраивать.

## Стратегии рестарта контейнеров в Docker

Когда вы создаете контейнер Docker, вы можете указать стратегию рестарта, которая определяет, как Docker должен управлять контейнером в случае его сбоя. Давайте разберемся, какие стратегии доступны и какие из них лучше использовать в зависимости от сценария.

### Политики рестарта

Docker предоставляет несколько встроенных политик рестарта, которые можно задать с помощью параметра `--restart` при запуске контейнера. Рассмотрим их подробнее:

#### no

Это дефолтная политика, если вы не указали никакую другую. Она означает, что контейнер не будет автоматически перезапускаться в случае сбоя. Это может быть полезно для кратковременных или тестовых контейнеров.

```bash
docker run --restart=no my-container
```
*Комментарий: контейнер не будет автоматически перезапущен при сбое*

#### always

С этой политикой Docker всегда будет пытаться перезапустить контейнер, независимо от причины его остановки, что подходит для долгосрочных сервисов.

```bash
docker run --restart=always my-container
```
*Комментарий: контейнер всегда перезапускается при сбое или даже после ручной остановки*

#### unless-stopped

Похожая на `always`, но с одним отличием — контейнер не перезапустится, если он был намеренно остановлен пользователем.

```bash
docker run --restart=unless-stopped my-container
```
*Комментарий: контейнер перезапускается после сбоя, если его не остановили вручную*

#### on-failure

Политика `on-failure` перезапускает контейнер только в случае его завершения из-за ошибки (ненулевой код выхода). Она также позволяет указать максимальное количество попыток перезапуска.

```bash
docker run --restart=on-failure:5 my-container
```
*Комментарий: контейнер перезапустится до 5 раз в случае сбоя*

### Преимущества и недостатки стратегий

- **always** и **unless-stopped** подходят для сервисов, которые должны быть всегда доступны. Однако они могут привести к непрерывным попыткам перезапуска при серьезных ошибках, не позволяя логам указывать на проблему.
 
- **on-failure** полезна для разработки и тестирования, ограничивая количество перезапусков и тем самым помогая в отладке. Но она не гарантирует полнофункциональную работу без внимания администратора.

- **no** обычно используется для одноразовых или временных задач, где сбои не имеют значения.

## Примеры настройки рестарта контейнеров

Давайте посмотрим на примеры использования политик перезапуска в Docker Compose. Docker Compose позволяет удобно управлять множеством контейнеров через один файл конфигурации `docker-compose.yml`.

### Пример конфигурации Docker Compose

```yaml
version: '3'
services:
  webapp:
    image: my-web-app
    restart: unless-stopped
  database:
    image: my-database
    restart: always
```
*Комментарий: Web-приложение перезапускается, если контейнеры не остановлены вручную; база данных перезапускается всегда*

## Заключение

Автоматический перезапуск контейнеров в Docker — это мощный инструмент, который может существенно повысить надежность и отказоустойчивость ваших приложений. Используя различные стратегии рестарта, вы можете эффективно управлять поведением контейнеров в случае сбоев. Будь то для обеспечения постоянной доступности или уведомления о возникновении проблем, понимание и правильная настройка этих стратегий являются важными аспектами при работе с Docker.