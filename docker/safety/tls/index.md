---
metaTitle: Защита с TLS в Docker
metaDescription: Изучите, как обеспечить защиту с помощью TLS в Docker, чтобы обезопасить ваши контейнеры и сервисы. Практическое руководство с примерами настройки и управления
author: Олег Марков
title: Защита с TLS в Docker
preview: Узнайте, как использовать TLS для защиты контейнеров Docker - настройка, управление и практические примеры помогут вам сделать ваши сервисы безопаснее
---

## Введение

Контейнеры Docker стали стандартным инструментом для разработки, тестирования и разворачивания приложений. Однако, с широким распространением приходит и повышенная угроза безопасности. Docker предлагает встроенные средства защиты, и одним из наиболее эффективных инструментов является поддержка TLS (Transport Layer Security). TLS позволяет шифровать данные, проходящие между Docker-клиентом и сервером, защищая их от перехвата и подмены.

В этой статье мы рассмотрим, как настроить и использовать TLS для улучшения безопасности ваших контейнеров Docker. Я покажу вам, как создать самоподписанный сертификат, как настроить Docker для использования TLS и как вызвать Docker API через защищенное соединение.

## Создание самоподписанного сертификата

Первым шагом в настройке TLS является создание самоподписанного сертификата. Мы будем использовать `openssl` – это удобный инструмент для работы с сертификатами.

Использование TLS позволяет обеспечить безопасное соединение с Docker-контейнерами и сервисами. Чтобы правильно настроить TLS, необходимо понимать принципы работы TLS и Docker. Если вы хотите детальнее погрузиться в Docker, узнать про базовые понятия Ansible, Ansible playbooks, развертку машин с Vagrant — приходите на наш большой курс [Docker + Ansible - с нуля](https://purpleschool.ru/course/docker?utm_source=knowledgebase&utm_medium=text&utm_campaign=Zashchita_s_TLS_v_Docker). На курсе 159 уроков и 7 упражнений, AI-тренажеры для безлимитной практики с кодом и задачами 24/7, решение задач с живым ревью наставника, еженедельные встречи с менторами.

### Генерация корневого сертификата (CA)

Корневой или самоподписанный сертификат CA (Certificate Authority) нужен для подписи других сертификатов.

```bash
# Создаем приватный ключ CA
openssl genpkey -algorithm RSA -out ca-key.pem

# Создаем самоподписанный корневой сертификат
openssl req -x509 -new -nodes -key ca-key.pem -days 365 -out ca.pem -subj "/CN=My Docker CA"
```

#### Объяснение кода:
- `genpkey -algorithm RSA` — команда генерирует RSA приватный ключ.
- `req -x509` — соответственно, создается новый запрос на сертификат и сразу подписывается для генерации сертификата CA.
- `-subj "/CN=My Docker CA"` — эта часть определяет поле субъекта в сертификате, которое может содержать любую удобную для вас информацию.

### Создание сертификатов для Docker сервера и клиента

Теперь давайте создадим персональные сертификаты для клиента и сервера Docker.

```bash
# Создаем серверный ключ и запрос сертификата
openssl genpkey -algorithm RSA -out server-key.pem
openssl req -new -key server-key.pem -out server.csr -subj "/CN=localhost"

# Подписываем серверный сертификат с помощью CA
openssl x509 -req -in server.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out server-cert.pem -days 365

# Создаем клиентский ключ и запрос сертификата
openssl genpkey -algorithm RSA -out key.pem
openssl req -new -key key.pem -out client.csr -subj "/CN=client"

# Подписываем клиентский сертификат с помощью CA
openssl x509 -req -in client.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out cert.pem -days 365
```

#### Объяснение:
- Мы выполняем похожие шаги для создания ключей и сертификатов сервера и клиента.
- `-CAcreateserial` создает файл с серийным номером подписи, необходимый при подписании сертификатов.

## Настройка Docker для использования TLS

Чтобы Docker использовал TLS, необходимо внести изменения в конфигурационные файлы Docker. Эти изменения могут касаться как демона Docker, так и клиента Docker.

### Конфигурация Docker демона

Для безопасного общения Docker демон должен быть настроен для работы с TLS:

- Создайте файл: `/etc/docker/daemon.json`
```json
{
    "tls": true,
    "tlsverify": true,
    "tlscacert": "/path/to/ca.pem",
    "tlscert": "/path/to/server-cert.pem",
    "tlskey": "/path/to/server-key.pem",
    "hosts": ["unix:///var/run/docker.sock", "tcp://0.0.0.0:2376"]
}
```
- После обновления конфигурации необходимо перезапустить Docker демон для применения изменений.

### Конфигурация Docker клиента

Для выполнения команд Docker клиентом по защищенному соединению необходимо явно указать использовать TLS:

```bash
export DOCKER_TLS_VERIFY=1
export DOCKER_CERT_PATH="/path/to/certs"
export DOCKER_HOST="tcp://<docker-host-ip>:2376"
```

Теперь клиент Docker будет подключаться к серверу через защищенное соединение.

## Использование Docker с TLS

После завершения настроек проверки можно начать использовать Docker с TLS. Давайте посмотрим, как можно обратиться к Docker API при помощи защищенного соединения.

### Пример вызова команды

```bash
docker --tlsverify --tlscacert=ca.pem --tlscert=cert.pem --tlskey=key.pem -H tcp://<docker-host-ip>:2376 info
```

#### Разбор примера:
- `--tlsverify` активирует проверку сертификата.
- `-H` указывает, что используется протокол tcp и адрес Docker API.

## Заключение

Защита с TLS в Docker — это мощный способ убедиться, что ваши данные остаются конфиденциальными между клиентом и сервером. Правильная настройка TLS помогает защитить систему от потенциальных угроз и улучшает доверие к вашим приложениям. Мы рассмотрели, как создать сертификаты, как их применить в Docker и проверить настроенные соединения. Эти шаги помогут вам сделать рабочее окружение более безопасным.

Для автоматизации настройки TLS в Docker-окружении можно использовать Ansible. На нашем курсе [Docker + Ansible - с нуля](https://purpleschool.ru/course/docker?utm_source=knowledgebase&utm_medium=text&utm_campaign=Zashchita_s_TLS_v_Docker) вы научитесь автоматизировать эти задачи. В первых 3 модулях уже доступно бесплатное содержание — начните погружаться в Docker и Ansible прямо сегодня.
