---
metaTitle: Как подключить прокси-сервер в Docker
metaDescription: Узнайте как настроить и подключить прокси-сервер в Docker эффективно используя конфигурационные файлы переменные окружения и аргументы командной строки
author: Олег Марков
title: Как подключить прокси-сервер в Docker
preview: В статье подробно описаны шаги по подключению прокси-сервера в Docker включая настройку конфигураций и использование переменных окружения что поможет оптимизировать сетевую работу контейнеров
---

## Введение

Docker — это мощное средство для работы с контейнерами, которое упрощает развертывание и управление приложениями. Одной из задач, с которой могут столкнуться пользователи Docker, является настройка подключения через прокси-сервер. Прокси-серверы важны для защиты сети, ускорения доступа к интернет-ресурсам и улучшения контроля трафика. В этой статье мы разберем, как подключить прокси-сервер в Docker, используя несколько простых методов. Я поделюсь с вами нужными настройками, включая использование переменных окружения и Dockerfile. 

## Установка и настройка прокси-сервера

Перед тем как мы погрузимся в детали конфигурации Docker, убедитесь, что у вас на сервере установлен и настроен прокси-сервер. Это может быть любой общедоступный сервер или локальный прокси, например, Squid. После установки важно проверить, что прокси работает корректно и доступен для подключения.

## Подключение прокси-сервера в Docker

Есть несколько способов подключить прокси-сервер к Docker, и мы обсудим каждый из них.

### Переменные окружения

Наиболее простой способ использовать прокси в Docker — настроить переменные окружения. Docker способен использовать стандартные переменные окружения HTTP_PROXY, HTTPS_PROXY и NO_PROXY. Эти переменные влияют на то, как Docker взаимодействует с внешними ресурсами.

#### Пример настройки переменных окружения

```shell
# Установите переменные окружения для использования прокси
export HTTP_PROXY=http://user:password@proxy-server:port
export HTTPS_PROXY=https://user:password@proxy-server:port
export NO_PROXY=localhost,127.0.0.1,*.mydomain.com
```

- `HTTP_PROXY` и `HTTPS_PROXY` указывают на соответствующие прокси-серверы.
- `NO_PROXY` позволяет указать адреса, для которых прокси не будет использоваться.

Эти переменные можно добавить в ваш файл `.bashrc` или `.bash_profile`, чтобы они применялись при каждом запуске терминала.

### Файл конфигурации Docker

Другой способ — использовать файл конфигурации Docker на уровне системы. Это полезно, когда вы хотите, чтобы настройки применялись глобально для всех контейнеров.

#### Пример создания конфигурационного файла

Создайте или отредактируйте файл конфигурации Docker, например, `/etc/docker/daemon.json`, добавив туда прокси-настройки.

```json
{
  "proxies": {
    "default": {
      "httpProxy": "http://user:password@proxy-server:port",
      "httpsProxy": "https://user:password@proxy-server:port",
      "noProxy": "localhost,127.0.0.1,*.mydomain.com"
    }
  }
}
```

После изменений перезапустите службу Docker, чтобы они вступили в силу:

```shell
sudo systemctl restart docker
```

### Настройка прокси внутри Dockerfile

Если вы хотите, чтобы только определенные приложения получили доступ к интернету через прокси, можно настроить прокси непосредственно в Dockerfile.

#### Пример использования Dockerfile

```dockerfile
# Указываем базовый образ
FROM ubuntu:20.04

# Устанавливаем переменные окружения для работы через прокси
ENV HTTP_PROXY="http://user:password@proxy-server:port"
ENV HTTPS_PROXY="https://user:password@proxy-server:port"

# Установка зависимостей
RUN apt-get update && apt-get install -y curl
```

Здесь вы устанавливаете переменные окружения в Dockerfile, которые будут использоваться во время выполнения команд `RUN`. Это удобно, если доступ к интернету нужен для каких-либо действий внутри контейнера, таких как обновление зависимостей.

## Заключение

Подключение прокси-сервера в Docker — это процесс, который можно реализовать несколькими способами, в зависимости от ваших нужд и предпочтений. Вы можете задать переменные окружения для системы, настроить глобальный конфигурационный файл Docker или добавить переменные непосредственно в Dockerfile. Каждый из этих методов имеет свои преимущества, и выбор остается за вами в зависимости от того, какие задачи вы решаете с помощью Docker. Надеюсь, эта статья была полезной, и теперь вы знаете, как правильно настроить Docker для использования через прокси-серверы.