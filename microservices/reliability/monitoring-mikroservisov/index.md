---
metaTitle: Мониторинг микросервисов и метрики
metaDescription: Изучите подходы к мониторингу микросервисов, настройку метрик и инструментов для отслеживания состояния распределённых систем
author: Олег Марков
title: Мониторинг микросервисов и метрики
preview: Разбор мониторинга микросервисов - какие метрики собирать, как анализировать состояние системы и инструменты для контроля производительности
---

## Введение

Мониторинг микросервисов — ключевой компонент стабильной работы распределённых систем. Он позволяет отслеживать состояние сервисов, выявлять узкие места и предсказывать сбои. Метрики помогают оценивать производительность и вовремя реагировать на аномалии. В этой статье мы разберемся, какие подходы к мониторингу использовать, как собирать метрики и какие инструменты помогают в управлении микросервисами.

## Основы мониторинга микросервисов

### Зачем нужен мониторинг

В распределённых системах количество сервисов может быть десятки или сотни. Без мониторинга невозможно эффективно управлять состоянием системы. Основные цели мониторинга:

* Определение работоспособности сервисов;
* Выявление узких мест и перегрузок;
* Предотвращение простоев и падений;
* Анализ производительности и оптимизация ресурсов.

### Виды метрик

Метрики можно разделить на несколько типов:

* **Инфраструктурные** — нагрузка CPU, использование памяти, дисковая активность;
* **Прикладные** — время ответа сервисов, количество запросов, ошибки;
* **Бизнес-метрики** — транзакции, продажи, конверсии.

Пример использования Python с библиотекой **Prometheus client** для сбора метрик:

```python
from prometheus_client import start_http_server, Summary
import random
import time

REQUEST_TIME = Summary('request_processing_seconds', 'Time spent processing request')

@REQUEST_TIME.time()
def process_request():
    time.sleep(random.random())

if __name__ == '__main__':
    start_http_server(8000)
    while True:
        process_request()
```

Этот код запускает HTTP-сервер, на котором Prometheus сможет собирать метрики времени обработки запросов.

Для более глубокого освоения мониторинга и управления микросервисами, включая сбор метрик, алерты и визуализацию, полезно изучить курс [Microservices](https://purpleschool.ru/course/microservices?utm_source=knowledgebase&utm_medium=article&utm_campaign=Monitoring_mikroservisov_i_metriki). На курсе 94 урока и 5 упражнений, AI-тренажеры для практики с кодом и задачами 24/7, решение задач с живым ревью наставника, еженедельные встречи с менторами.

## Инструменты для мониторинга

* **Prometheus** — сбор и хранение метрик с поддержкой алертов;
* **Grafana** — визуализация метрик, создание дашбордов;
* **ELK Stack** — анализ логов и производительности;
* **Jaeger** — распределённый трейсинг для анализа времени выполнения запросов между сервисами;
* **New Relic, Datadog** — коммерческие решения для комплексного мониторинга.

### Настройка метрик в Kubernetes

В Kubernetes удобно использовать **Metrics Server** и **Prometheus Operator** для автоматического сбора и визуализации метрик подов и нод. Пример конфигурации Prometheus Operator:

```yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: payment-service-monitor
spec:
  selector:
    matchLabels:
      app: payment-service
  endpoints:
    - port: metrics
      interval: 30s
```

Эта конфигурация позволит Prometheus собирать метрики с микросервиса `payment-service` каждые 30 секунд.

## Частые ошибки

* Игнорирование бизнес-метрик;
* Сбор только локальных метрик без централизованного хранения;
* Отсутствие алертов при критических значениях;
* Перегрузка системы слишком частым сбором данных.

## Частозадаваемые вопросы

**Нужно ли мониторить каждый микросервис?**
Да, чтобы получить полное представление о состоянии системы.

**Как часто обновлять метрики?**
Интервал зависит от критичности данных: для производительности — каждые 15–30 секунд, для бизнес-метрик — 1–5 минут.

## Заключение

Мониторинг микросервисов и сбор метрик — обязательные элементы поддержки стабильной работы распределённых систем. Своевременный анализ показателей позволяет предотвращать сбои и оптимизировать производительность.

Использование мониторинга ускоряет диагностику и улучшает управляемость микросервисов. Для закрепления навыков работы с метриками и изучения дополнительных возможностей микросервисной архитектуры рекомендуем курс [Microservices](https://purpleschool.ru/course/microservices?utm_source=knowledgebase&utm_medium=article&utm_campaign=Monitoring_mikroservisov_i_metriki).
В первых 3 модулях курса доступно бесплатное содержание, что позволяет попробовать сбор метрик и визуализацию на практике и понять структуру курса до покупки полного доступа.
