---
metaTitle: Мониторинг Golang приложений с помощью Prometheus
metaDescription: Узнайте как интегрировать Prometheus в ваше Golang приложение для эффективного мониторинга. Пошаговые инструкции и примеры кода помогут вам начать работу с системой мониторинга
author: Олег Марков
title: Мониторинг Golang приложений с помощью Prometheus
preview: В этом руководстве мы разберем, как настроить и интегрировать мониторание Golang приложения с помощью Prometheus. Вы узнаете об основных функциях и возможностях этой мощной системы мониторинга
---

## Введение

Мониторинг приложений — важная часть разработки современных программных продуктов. Внедрение систем мониторинга позволяет выявлять и решать проблемы производительности и надежности на ранних стадиях. Prometheus — это одна из самых популярных систем для мониторинга приложений с открытым исходным кодом. Она предоставляет мощные инструменты для сбора и анализа данных о работе вашего кода.

В этой статье мы обсудим, как использовать Prometheus для мониторинга Golang приложений. Мы займемся интеграцией этой системы в ваш проект, чтобы вы смогли легко отслеживать ключевые метрики и быть уверенными в стабильной работе вашего приложения.

Мониторинг — важный аспект разработки надежных приложений. Чтобы эффективно использовать Prometheus для мониторинга Go-приложений, необходимо понимать, как работают HTTP-серверы, как собирать метрики и как строить дашборды. Если вы хотите детальнее погрузиться в эти темы — приходите на наш большой курс [Продвинутый Golang](https://purpleschool.ru/course/go-advanced?utm_source=knowledgebase&utm_medium=text&utm_campaign=monitoring-golang-prilozheniy-s-pomoschyu-prometheus). На курсе 179 уроков и 22 упражнения, AI-тренажеры для безлимитной практики с кодом и задачами 24/7, решение задач с живым ревью наставника, еженедельные встречи с менторами.

## Установка и настройка Prometheus

Перед тем как начать интеграцию, необходимо установить и настроить Prometheus. Для этого выполните следующие шаги:

1. Скачайте [Prometheus](https://prometheus.io/download/) с официального сайта.
2. Разархивируйте скачанный файл в удобное для вас место.
3. Создайте конфигурационный файл `prometheus.yml`. Он потребуется для определения, какие данные вы хотите собирать и откуда. Пример простейшего файла конфигурации:

```yaml
# Здесь мы определяем, откуда Prometheus будет забирать данные
scrape_configs:
  - job_name: 'your_golang_app'
    static_configs:
      - targets: ['localhost:9090'] # Замените на фактический адрес и порт вашего приложения
```

## Интеграция Prometheus с Golang приложением

Чтобы Prometheus мог собирать метрики с вашего приложения, его нужно интегрировать в код. Воспользуемся пакетом [prometheus/client_golang](https://github.com/prometheus/client_golang), который предоставляет все необходимые инструменты.

### Установка библиотеки

Начнем с установки библиотеки prometheus/client_golang:

```bash
go get github.com/prometheus/client_golang/prometheus
go get github.com/prometheus/client_golang/prometheus/promhttp
```

### Настройка метрик

Теперь, когда библиотека установлена, давайте создадим несколько метрик в вашем приложении. Метрик может быть много — от временных задержек до количества запросов. Для простоты начнем с простой метрики, которая считает количество HTTP-запросов:

```go
package main

import (
    "net/http"

    "github.com/prometheus/client_golang/prometheus"
    "github.com/prometheus/client_golang/prometheus/promhttp"
)

// Создание счетчика HTTP-запросов
var httpRequestsTotal = prometheus.NewCounterVec(
    prometheus.CounterOpts{
        Name: "http_requests_total",
        Help: "Total number of HTTP requests",
    },
    []string{"path"}, // Лейблы для метрики
)

func main() {
    // Регистрируем метрику в Prometheus
    prometheus.MustRegister(httpRequestsTotal)

    http.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {
        httpRequestsTotal.WithLabelValues(r.URL.Path).Inc() // Увеличиваем счетчик при каждом запросе
        w.Write([]byte("Hello, world!"))
    })

    // Настраиваем обработчик для /metrics
    http.Handle("/metrics", promhttp.Handler())

    // Запуск HTTP-сервера
    http.ListenAndServe(":9090", nil)
}
```

В этом коде мы создаем счетчик HTTP-запросов, который увеличивается при каждом обращении к приложению. Обратите внимание, как мы используем `promhttp.Handler()` для обработки запросов к `/metrics`. Этот обработчик автоматически экспортирует все зарегистрированные метрики, готовые для сбора Prometheus.

### Запуск Prometheus и приложения

Теперь пришло время запустить как ваше приложение, так и Prometheus. Для этого откройте терминал и выполните следующие команды:

1. Запустите ваше Golang приложение:
   ```bash
   go run main.go
   ```

2. Запустите Prometheus:
   ```bash
   ./prometheus --config.file=prometheus.yml
   ```

Prometheus должен начать собирать данные с вашего приложения. Вы можете убедиться в этом, открыв интерфейс Prometheus по адресу `http://localhost:9090` и перейдя в раздел "Graph", где можно выполнить запрос `http_requests_total` и увидеть график с количеством запросов.

## Заключение

Теперь вы знаете, как интегрировать Prometheus в ваше Golang приложение для сбора метрик. Мы рассмотрели установку и настройку Prometheus, а также создание и регистрацию метрик в вашем приложении. С Prometheus у вас есть мощный инструмент для мониторинга, который поможет вам отслеживать ключевые метрики и обеспечивать стабильную работу вашего кода. Не стесняйтесь экспериментировать и добавлять больше метрик для более глубокого анализа работы вашего приложения.

Теперь вы знаете, как интегрировать Prometheus в ваши Go-приложения. Чтобы систематизировать свои знания Go и научиться писать отказоустойчивый backend код, обратите внимание на курс [Продвинутый Golang](https://purpleschool.ru/course/go-advanced?utm_source=knowledgebase&utm_medium=text&utm_campaign=monitoring-golang-prilozheniy-s-pomoschyu-prometheus). В первых 3 модулях уже доступно бесплатное содержание — начните погружаться в Go прямо сегодня и станьте уверенным разработчиком.
