---
metaTitle: Как выбрать подходящую версию Kubernetes
metaDescription: Руководство по выбору версии Kubernetes - лучшие практики обновления и сравнения возможностей, совместимость с облаками и советы по миграции
author: Олег Марков
title: Как выбрать подходящую версию Kubernetes
preview: Подробное руководство по выбору подходящей версии Kubernetes - анализ жизненного цикла, совместимости, нововведений и важных отличий между релизами
---

## Введение

Kubernetes остается одной из самых популярных платформ для управления контейнерами, и этот успех приносит не только богатый набор функций, но и регулярные обновления. Перед любой компанией или разработчиком всегда стоит вопрос: какую версию Kubernetes выбрать для нового проекта или обновления существующего кластера? Разные версии не только отличаются функциональностью, но и временем поддержки, безопасностью, совместимостью с окружением и сторонними инструментами. Разберём важные шаги и критерии выбора версии, чтобы вы могли уверенно подобрать оптимальный вариант под ваши задачи.

## Понимание жизненного цикла версий Kubernetes

### Структура версий Kubernetes

Kubernetes использует [семантическое версионирование](https://semver.org/) с паттерном `MAJOR.MINOR.PATCH`. Например, версия 1.28.3:

- **MAJOR** — радикальные архитектурные изменения (в Kubernetes всегда "1"),
- **MINOR** — релизы с новыми функциями (пример: 1.28),
- **PATCH** — исправления багов и уязвимостей (пример: 1.28.3).

Смотрите, если появляется версия 1.29, значит добавлены новые возможности или изменено поведение уже привычных вещей. Патч 1.28.4 принесёт только исправления ошибок.

### Поддержка релизов и сроки жизни (EOL)

Kubernetes выпускает MINOR-обновления примерно раз в четыре месяца. Каждое такое обновление поддерживается в течение примерно 1 года с даты релиза этой версии. После этого релиз снимают с поддержки (EOL — End Of Life), и сообщество больше не выпускает ни обновлений безопасности, ни багфиксов.

| Версия       | Дата релиза  | Поддержка до     |
|:-------------|:-------------|:-----------------|
| 1.28         | Авг 2023     | Авг 2024         |
| 1.27         | Апр 2023     | Апр 2024         |
| 1.26         | Дек 2022     | Дек 2023         |

> Обратите внимание, чтобы обследовать сроки поддержки, посетите [официальный календарь релизов Kubernetes](https://kubernetes.io/releases/).

### Почему важно использовать поддерживаемые версии

Использование актуальной версии критично с точки зрения:

- безопасности (только поддерживаемые версии получают патчи уязвимостей),
- совместимости с новыми библиотеками и инструментами,
- технической поддержки (и внутри компании, и у облачных провайдеров).

Если ваша версия устарела, вы рискуете получить несовместимость с новыми Helm-чартами, CRI (Container Runtime Interface), сетевыми и storage-плагинами.

## Как определить подходящую версию для ваших задач

### Анализ требований к приложению и инфраструктуре

Для начала оцените:

- Требования приложений (требуется ли поддержка последних CRD, sidecar containers, возможностей security etc.),
- Стабильность и зрелость фич (какие модули нужны, являются ли они уже стабильной частью API),
- Необходимо ли использовать дополнительные контроллеры, плагины, сервис-меши, которые поддерживают не все версии Kubernetes.

Популярная встречающаяся ситуация — нужен флаггированый функционал (например, Ephemeral Containers из alpha или beta), но в продакшне использовать альфа-возможности не рекомендуется.

### Совместимость с инфраструктурой и облачными платформами

Крупные облачные провайдеры (GKE, EKS, AKS) поддерживают ограниченное число версий Kubernetes. Проверьте:

- Какую минимальную и максимальную версию поддерживает ваша платформа,
- Схема обновлений — не всегда можно сразу обновиться на самую свежую версию,
- Совместимость CSI, CNI, ingress-контроллеров, сервис-мешей и других компонентов с нужной версией Kubernetes.

Пример:
- В AWS EKS на момент публикации не всегда доступна самая свежая версия Kubernetes — зачастую версии идут с задержкой несколько месяцев.

### Учёт совместимости API и изменений между версиями

Каждая MINOR-версия может включать изменения в API, переводит alpha/beta фичи в стабильные или, наоборот, объявляет устаревшими и удаляет устаревшие API. Перед обновлением ознакомьтесь с [Changelog](https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG.md).

#### Проверка совместимости манифестов

Бывает, что часть используемых вами манифестов или Helm-чартов могут не поддерживать новую версию API.

Вот как проверить ваши ресурсы на устаревание спецификаций прямо через kubectl:

```bash
# Проверяем все манифесты на устаревшие API:
kubectl get all --all-namespaces -o yaml | grep 'apiVersion'
```

Если видите предупреждения о deprecated-версиях API (например, `extensions/v1beta1`), значит, необходимо обновить манифесты перед апгрейдом.

### Выбор типа и стабильности функций

API Kubernetes делятся на несколько категорий стабильности:

- **Alpha** — экспериментальные, можно использовать только в тестовых кластерах,
- **Beta** — обычно достаточно стабильны для тестов и pre-prod,
- **Stable (GA)** — безопасно использовать в продакшне.

Для оптимальной стабильности в продакшне старайтесь ориентироваться на версии с нужными фичами в статусе "Stable".

## Лучшие практики обновления и миграции версий

### Планирование процесса обновления

Диапазон поддерживаемых MINOR-версий при обновлении — обычно один шаг (например, с 1.26 на 1.27). Не пытайтесь сразу прыгнуть через несколько версий, это может привести к поломке API или несовместимостям:

```bash
# Проверяем текущую версию кластера
kubectl version

# Плавно обновляем минорные версии
# например: сначала 1.25 -> 1.26, затем 1.26 -> 1.27
```

Используйте тестовые среды ("staging", "test clusters"), чтобы выявить проблемы до обновления продакшна. Не забывайте запускать инструменты для проверки совместимости, например [kube-no-trouble (kubent)](https://github.com/doitintl/kube-no-trouble):

```bash
# Проверяем кластер на устаревшие ресурсы перед апгрейдом
kubent
```

### Бэкапы и обратное тестирование

Перед обновлением обязательно:

- Дампите базу состояния etcd,
- Экспортируйте все манифесты,
- Тестируйте возможность отката.

### Обновление компонентов кластера поочередно

Обновление компонентов кластера (control plane, worker-нод, сетевого стека) следует производить поэтапно: сначала мастер-нод, затем рабочие. Между этапами убеждайтесь, что кластер функционирует корректно.

Для kubeadm-кластеров:

```bash
# Обновление control plane
sudo kubeadm upgrade plan
sudo kubeadm upgrade apply v1.28.3

# Обновление kubelet и kubectl на каждом worker
sudo apt-get install -y kubelet=1.28.3-00 kubectl=1.28.3-00
sudo systemctl restart kubelet
```

## Как читать "Release Notes" и оценивать важные изменения

Когда выходит новая версия Kubernetes, обязательно читайте официальные "release notes":

- Что нового и какие проблемы решены,
- Какие фичи стали доступными или стабильными,
- Какие API считаются "deprecated" и будут удалены,
- Отдельное внимание на изменения, влияющие на работу сетевого, storage, ingress провайдеров.

Обычно "release notes" разбиты на "New Features", "Bug Fixes", "Deprecations and Removals", что облегчает поиск нужной информации.

Обратите внимание: если используемые вами фичи только появились в beta/alpha, стоит подождать миграции в стабильный релиз.

## Выбор между "Bleeding Edge" и стабильностью

Если вы:

- Поддерживаете высоконагруженный production,
- Требуете максимальной стабильности и быстрого восстановления,
- Считаете важной совместимость с инструментами экосистемы,

то останавливайтесь на последних двух поддерживаемых версиях, а не на самой свежей MINOR (которая может содержать свежие баги или несовместимости).

Если вам критичны свежие фичи (например — для POC, активной работы с cloud native), тщательно тестируйте такие кластеры и будьте готовы к обратимым изменениям, возможному отказу части tooling.

## Как Kubernetes внедряет Backward Incompatibility

Когда происходит устаревание (deprecation) функций, Kubernetes, как правило, несколько версий прощается с API и только затем их удаляет. Например, если в v1.22 объявлено, что `extensions/v1beta1` депрекейтед, то реально API могут удалить только через две-три MINOR-версии.

Это даёт вам время и пространство для миграции, но тем не менее лучше сразу поддерживать актуальность манифестов.

## Пример процесса выбора версии на практике

Давайте разберём ситуацию: команда запускает новый production-кластер в облаке.

1. Изучаем, какие версии доступны в managed Kubernetes (например, GKE или EKS).
2. Смотрим последние два MINOR-релиза, поддерживаемых провайдером.
3. Сверяем необходимые функции и API: подходят ли доступные версии для используемых Helm-чартов и CRD.
4. Изучаем совместимость с CI/CD, сервисами мониторинга, CSI/CNI-провайдерами.
5. Помечаем все используемые alpha/beta фичи, взвешиваем критичность их отсутствия.
6. Выбираем наименее старую поддерживаемую MINOR-версию (например, не 1.25, а 1.27) и тестируем на non-production среде.
7. Только после обкатки манифестов и всех сторонних Chart-ов переходим на выбранную версию.

## Резюме

Выбор подходящей версии Kubernetes зависит от комбинации факторов: жизненного цикла релиза, поддержки облачных платформ, наличия критичных для вас возможностей, совместимости используемых API, стабильности новых фичей и политик безопасности. Не всегда самое новое — самое лучшее. Используйте пробные среды, уделяйте внимание release notes и совместимости, не спешите с минорными и особенно мажорными апдейтами.

## Частозадаваемые технические вопросы по теме статьи и ответы на них

### Как узнать, какие CRD/ресурсы в моём кластере используют устаревшие версии API?

Используйте утилиту [kubent (kube-no-trouble)](https://github.com/doitintl/kube-no-trouble) — она покажет все ресурсы, которые будут несовместимы с будущими версиями. Запустите в кластере:
```bash
kubent
```
Посмотрите отчёт — он подскажет, какие объекты потребуется обновлять.

### Как проверить, поддерживает ли Helm-чарт нужную версию Kubernetes?

В metadata Helm-чарта обычно задано минимально- и максимально поддерживаемое значение поля `kubeVersion`. Откройте файл `Chart.yaml` и проверьте параметр:
```yaml
kubeVersion: ">=1.25.0 <1.29.0"
```
Если вашей версии нет в диапазоне, лучше искать другой чарт или обновить его самостоятельно.

### Что делать, если облачный провайдер не поддерживает нужную мне версию Kubernetes?

- Проверьте официальную дорожную карту обновлений провайдера.
- Если критичная функция недоступна, ищите Workaround (альтернативные решения) – например, использование сторонних CRD.
- Временно размещайте нагрузку в self-managed кластере или ожидайте обновления от провайдера.

### Как быстро обновить все манифесты после изменений в API?

- Используйте search-and-replace в редакторе или специализированные инструменты (например, [Kube-Review](https://github.com/stefanprodan/kube-review)).
- Читайте release notes — зачастую фрагменты новых API публикуются прямо в них.
- Автоматизируйте деплой манифестов через CI/CD: так легче версионировать изменения.

### Можно ли использовать mix-версию kubelet или kubectl в кластере?

Можно, но нежелательно. kubelet и kubectl обычно должны соответствовать MINOR-версии control-plane или отличаться не более чем на одну MINOR-версию. Большая разница может привести к сбоям или несовместимости команд.